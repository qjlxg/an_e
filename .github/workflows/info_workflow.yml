name: Xalpha Info Script Workflow (Cç±»ä»£ç )

# å½“ info.py, Cç±».txt æˆ–å·¥ä½œæµæ–‡ä»¶æœ¬èº«æœ‰ push æ—¶è§¦å‘
on:
  push:
    branches:
      - main  # å‡è®¾æ‚¨çš„ä¸»åˆ†æ”¯æ˜¯ main
    paths:
      - 'info.py'
      - 'Cç±».txt'
      - '.github/workflows/info_workflow.yml'
  
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  run_info_script:
    runs-on: ubuntu-latest
    
    steps:
      - name: â¬‡ï¸ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          # ä½¿ç”¨ GITHUB_TOKEN æƒé™ï¼Œä»¥ä¾¿å°†ç»“æœæ¨é€å›ä»“åº“
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: ğŸ è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' 
          
      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: |
          python -m pip install --upgrade pip
          # å®‰è£… info.py ä¸­ä¾èµ–çš„æ ¸å¿ƒåº“
          pip install pandas sqlalchemy beautifulsoup4 lxml xalpha requests
          
      - name: ğŸƒ è¿è¡Œ info.py è„šæœ¬ (è®¾ç½®ä¸Šæµ·æ—¶åŒº)
        # è®¾ç½®æ—¶åŒºä»¥ç¡®ä¿ report.txt ä¸­çš„æ—¶é—´æˆ³æ­£ç¡®
        env:
          TZ: Asia/Shanghai 
        run: |
          echo "Running info.py script in $TZ timezone."
          # ç›´æ¥è¿è¡Œ info.pyï¼Œå®ƒä¼šè´Ÿè´£è¯»å– Cç±».txt å¹¶ç”Ÿæˆ report.txt
          python info.py
          
      - name: ğŸ“ æäº¤ç»“æœåˆ°ä»“åº“
        run: |
          # é…ç½® git ç”¨æˆ·ä¿¡æ¯
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          # æ·»åŠ ç”Ÿæˆçš„ç»“æœæ–‡ä»¶
          git add workflow_outputs/report.txt
          
          # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶å˜åŠ¨éœ€è¦æäº¤
          if git diff --staged --quiet; then
              echo "No changes to commit. Exiting."
          else
              # æäº¤å˜åŠ¨
              git commit -m "ğŸ¤– Workflow: Update Cç±» report for run ${{ github.run_id }}"
              
              # æ¨é€å˜åŠ¨åˆ°è¿œç¨‹ä»“åº“
              git push
          fi
