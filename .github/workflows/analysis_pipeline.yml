# .github/workflows/analysis_pipeline.yml

name: Fund Analysis Pipeline (Dual Strategy)

on:
  # 1. æ‰‹åŠ¨è§¦å‘ (Run workflow)
  workflow_dispatch:

  # 2. è„šæœ¬æˆ–å·¥ä½œæµæ–‡ä»¶å˜åŠ¨æ—¶è‡ªåŠ¨è§¦å‘
  push:
    branches:
      - main  # æ›¿æ¢ä¸ºä½ çš„ä¸»åˆ†æ”¯åç§°
    paths:
      - 'analyzer.py'
      - 'trend_follower.py'
      - '.github/workflows/analysis_pipeline.yml'
      
  # 3. æ¯å¤©å®šæ—¶è¿è¡Œ (ä¾‹å¦‚ï¼šåŒ—äº¬æ—¶é—´ 22:30)
  schedule:
    # cronè¡¨è¾¾å¼åŸºäº UTC æ—¶é—´ã€‚åŒ—äº¬æ—¶é—´ 22:30 æ˜¯ UTC æ—¶é—´ 14:30
    - cron: '30 14 * * *'

jobs:
  run_analysis:
    runs-on: ubuntu-latest
    
    # è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œç¡®ä¿ Python è„šæœ¬å†…çš„æ—¶é—´å‡½æ•°èƒ½æ­£ç¡®è·å–ä¸Šæµ·æ—¶åŒº
    env:
      TZ: 'Asia/Shanghai'

    steps:
      - name: â¬‡ï¸ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: ğŸ“¦ Install dependencies (å®‰è£… Pandas, NumPy, pytz)
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy pytz

      - name: âš™ï¸ Run Deep Value Strategy (è¶…è·Œåå¼¹)
        # è¿è¡Œ analyzer.py
        run: python analyzer.py

      - name: ğŸ“ˆ Run Trend Follow Strategy (è¶‹åŠ¿è·Ÿéš)
        # è¿è¡Œ trend_follower.py
        run: python trend_follower.py
        
      # --- å°†ç”Ÿæˆçš„æ–°æ–‡ä»¶æäº¤å›ä»“åº“ ---
      # æŠ¥å‘Šæ–‡ä»¶å·²ç”±è„šæœ¬ç”Ÿæˆåœ¨å¹´æœˆç›®å½•ä¸­ (ä¾‹å¦‚ 202410/...)
      - name: â¬†ï¸ Commit and Push Report Files
        # ä½¿ç”¨ git-auto-commit-action è‡ªåŠ¨æäº¤æ›´æ”¹
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # ä»…åŒ¹é…è„šæœ¬ç”Ÿæˆçš„æŠ¥å‘Šæ–‡ä»¶ (æ‰€æœ‰å¹´æœˆå­ç›®å½•ä¸‹çš„ .md æ–‡ä»¶)
          file_pattern: |
            */*.md
          commit_message: "ğŸ¤– Feat: Auto-generate analysis reports [${{ github.event_name }} trigger]"
          branch: main # æ›¿æ¢ä¸ºä½ çš„ä¸»åˆ†æ”¯åç§°
